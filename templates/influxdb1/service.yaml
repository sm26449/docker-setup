name: influxdb1
description: "InfluxDB 1.x time-series database (legacy)"

variables:
  INFLUXDB1_PORT:
    default: "8086"
    description: "InfluxDB HTTP API port"
  INFLUXDB1_DB:
    default: "homeassistant"
    description: "Default database name"
  INFLUXDB1_ADMIN_USER:
    default: "admin"
    description: "Admin username"
  INFLUXDB1_ADMIN_PASSWORD:
    default: ""
    description: "Admin password"
    generate: password
  INFLUXDB1_USER:
    default: "influxdb"
    description: "Regular user username"
  INFLUXDB1_USER_PASSWORD:
    default: ""
    description: "Regular user password"
    generate: password
  INFLUXDB1_READ_USER:
    default: "grafana"
    description: "Read-only user for Grafana"
  INFLUXDB1_READ_PASSWORD:
    default: ""
    description: "Read-only user password"
    generate: password

config_files:
  - path: "config/influxdb.conf"
    content: |
      # InfluxDB 1.x Configuration
      # Generated by Docker Services Manager

      [meta]
        dir = "/var/lib/influxdb/meta"

      [data]
        dir = "/var/lib/influxdb/data"
        wal-dir = "/var/lib/influxdb/wal"
        series-id-set-cache-size = 100

      [coordinator]
        write-timeout = "10s"
        max-concurrent-queries = 0
        query-timeout = "0s"
        log-queries-after = "0s"
        max-select-point = 0
        max-select-series = 0
        max-select-buckets = 0

      [retention]
        enabled = true
        check-interval = "30m"

      [http]
        enabled = true
        bind-address = ":8086"
        auth-enabled = true
        log-enabled = true
        write-tracing = false
        pprof-enabled = true
        https-enabled = false

      [logging]
        format = "auto"
        level = "info"
        suppress-logo = false

compose: |
  influxdb1:
    image: influxdb:1.8
    container_name: influxdb1
    restart: unless-stopped
    ports:
      - "${INFLUXDB1_PORT:-8086}:8086"
    environment:
      - INFLUXDB_DB=${INFLUXDB1_DB:-homeassistant}
      - INFLUXDB_ADMIN_USER=${INFLUXDB1_ADMIN_USER:-admin}
      - INFLUXDB_ADMIN_PASSWORD=${INFLUXDB1_ADMIN_PASSWORD}
      - INFLUXDB_USER=${INFLUXDB1_USER:-influxdb}
      - INFLUXDB_USER_PASSWORD=${INFLUXDB1_USER_PASSWORD}
      - INFLUXDB_READ_USER=${INFLUXDB1_READ_USER:-grafana}
      - INFLUXDB_READ_USER_PASSWORD=${INFLUXDB1_READ_PASSWORD}
      - INFLUXDB_HTTP_AUTH_ENABLED=true
    volumes:
      - ${DOCKER_ROOT}/influxdb1/data:/var/lib/influxdb
      - ${DOCKER_ROOT}/influxdb1/config/influxdb.conf:/etc/influxdb/influxdb.conf:ro
