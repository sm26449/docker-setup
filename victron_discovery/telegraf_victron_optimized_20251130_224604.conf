# Optimized Telegraf Configuration for Victron Energy
# Auto-generated: 2025-11-30T22:46:04.668039
# Portal ID: c0619ab7d12b
#
# This configuration:
#   - Flattens nested paths into field names
#   - Converts string values to appropriate types
#   - Groups related metrics for easier querying

[global_tags]
  portal_id = "c0619ab7d12b"

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  flush_interval = "10s"

###############################################################################
#                            OUTPUT PLUGINS                                   #
###############################################################################

[[outputs.influxdb_v2]]
  urls = ["${TELEGRAF_INFLUXDB_URL}"]
  token = "${TELEGRAF_INFLUXDB_TOKEN}"
  organization = "${TELEGRAF_INFLUXDB_ORG}"
  bucket = "${TELEGRAF_INFLUXDB_BUCKET}"

###############################################################################
#                            INPUT PLUGINS                                    #
###############################################################################

# BATTERY - instances: 288, 512
[[inputs.mqtt_consumer]]
  name_override = "battery"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-battery"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/battery/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# GRID - instances: 0
[[inputs.mqtt_consumer]]
  name_override = "grid"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-grid"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/grid/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# HUB4 - instances: 0
[[inputs.mqtt_consumer]]
  name_override = "hub4"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-hub4"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/hub4/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# PLATFORM - instances: 0
[[inputs.mqtt_consumer]]
  name_override = "platform"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-platform"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/platform/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# PVINVERTER - instances: 21, 23, 24, 25
[[inputs.mqtt_consumer]]
  name_override = "pvinverter"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-pvinverter"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/pvinverter/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# SYSTEM - instances: 0
[[inputs.mqtt_consumer]]
  name_override = "system"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-system"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/system/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# TEMPERATURE - instances: 22, 23, 24
[[inputs.mqtt_consumer]]
  name_override = "temperature"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-temperature"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/temperature/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# VEBUS - instances: 274
[[inputs.mqtt_consumer]]
  name_override = "vebus"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-vebus"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/vebus/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

# VECAN - instances: vecan1
[[inputs.mqtt_consumer]]
  name_override = "vecan"
  servers = ["ssl://192.168.88.250:8883"]
  client_id = "telegraf-victron-vecan"
  qos = 0

  username = "admin"
  password = "rbdc9vtrc8"

  insecure_skip_verify = true

  topics = [
    "N/c0619ab7d12b/vecan/#",
  ]

  data_format = "json_v2"

  [[inputs.mqtt_consumer.json_v2]]
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "value"

  # Parse instance from topic
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+"
    tags = "_/_/_/instance/field"

  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "N/+/+/+/+/+"
    tags = "_/_/_/instance/field/subfield"

###############################################################################
#                          PROCESSOR PLUGINS                                  #
###############################################################################

# Rename nested fields for easier querying
[[processors.rename]]
  [[processors.rename.replace]]
    field = "value"
    dest = "measurement_value"
